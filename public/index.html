<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Acompanhamento de L√≠deres</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        header h1 {
            color: #1F4E78;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        header p {
            color: #666;
            font-size: 14px;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #1F4E78;
            color: white;
        }
        
        .btn-primary:hover {
            background: #163a5f;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(31, 78, 120, 0.3);
        }
        
        .btn-secondary {
            background: #4472C4;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #3558a0;
        }
        
        .btn-success {
            background: #70AD47;
            color: white;
        }
        
        .btn-danger {
            background: #C5504C;
            color: white;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .card h3 {
            color: #1F4E78;
            margin-bottom: 15px;
            font-size: 16px;
            border-bottom: 2px solid #4472C4;
            padding-bottom: 10px;
        }
        
        .stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .stat:last-child {
            border-bottom: none;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        
        .stat-value {
            color: #1F4E78;
            font-weight: bold;
            font-size: 18px;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
        }
        
        .table-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        thead {
            background: #1F4E78;
            color: white;
        }
        
        th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }
        
        tbody tr:hover {
            background: #f5f5f5;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-good {
            background: #d4edda;
            color: #155724;
        }
        
        .status-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-danger {
            background: #f8d7da;
            color: #721c24;
        }
        
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }
        
        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            overflow-y: auto;
        }
        
        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #4472C4;
            padding-bottom: 15px;
        }
        
        .close {
            font-size: 28px;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
        }
        
        .close:hover {
            color: #000;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 600;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            font-family: inherit;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #4472C4;
            box-shadow: 0 0 5px rgba(68, 114, 196, 0.3);
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            color: #1F4E78;
            border-bottom-color: #4472C4;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .rating-input {
            display: flex;
            gap: 5px;
        }
        
        .star {
            font-size: 24px;
            cursor: pointer;
            color: #ddd;
            transition: color 0.2s;
        }
        
        .star:hover,
        .star.active {
            color: #ffc107;
        }

        .relatorio-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
        }

        .relatorio-tab-btn {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .relatorio-tab-btn.active {
            color: #1F4E78;
            border-bottom-color: #4472C4;
        }

        .relatorio-content {
            display: none;
        }

        .relatorio-content.active {
            display: block;
        }

        .relatorio-select {
            margin-bottom: 20px;
        }

        .padrao-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #4472C4;
            page-break-inside: avoid;
        }

        .padrao-titulo {
            color: #1F4E78;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .padrao-nota {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .nota-barra {
            flex: 1;
            background: #eee;
            border-radius: 5px;
            height: 25px;
            overflow: hidden;
        }

        .nota-preenchida {
            height: 100%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }

        .recomendacoes {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 5px;
            border-left: 3px solid #70AD47;
        }

        .recomendacoes h5 {
            color: #70AD47;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .recomendacoes ul {
            margin-left: 20px;
            color: #333;
            font-size: 13px;
            line-height: 1.6;
        }

        .resumo-geral {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            border: 2px solid #4472C4;
        }

        .resumo-geral h3 {
            color: #1F4E78;
            margin-bottom: 15px;
            border: none;
            padding: 0;
        }

        .resumo-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .resumo-item:last-child {
            border-bottom: none;
        }

        @media print {
            body {
                background: white;
            }
            .controls, .btn, .tabs, .relatorio-tabs, .modal {
                display: none !important;
            }
            .padrao-item {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä Sistema de Acompanhamento de L√≠deres</h1>
            <p>Monitore o desempenho dos l√≠deres em rela√ß√£o aos padr√µes de lideran√ßa</p>
            <div class="controls">
                <button class="btn btn-primary" onclick="openAddLiderModal()">+ Adicionar L√≠der</button>
                <button class="btn btn-secondary" onclick="openAddReuniao()">+ Registrar Reuni√£o</button>
                <button class="btn btn-success" onclick="abrirRelatorios()">üìÑ Relat√≥rios</button>
                <button class="btn btn-secondary" onclick="exportarCSV()">üì• Exportar CSV</button>
            </div>
        </header>
        
        <div class="dashboard">
            <div class="card">
                <h3>üìà Estat√≠sticas Gerais</h3>
                <div class="stat">
                    <span class="stat-label">Total de L√≠deres</span>
                    <span class="stat-value" id="totalLideres">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Presen√ßa M√©dia</span>
                    <span class="stat-value" id="presenciaMedia">0%</span>
                </div>
                <div class="stat">
                    <span class="stat-label">M√©dia de Padr√µes</span>
                    <span class="stat-value" id="mediaPardroes">0.0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Reuni√µes Registradas</span>
                    <span class="stat-value" id="totalReunioes">0</span>
                </div>
            </div>
            
            <div class="card">
                <h3>‚ö†Ô∏è Alertas</h3>
                <div id="alertas-container">
                    <p style="color: #999; font-size: 14px;">Nenhum alerta no momento</p>
                </div>
            </div>
            
            <div class="card">
                <h3>üéØ Padr√µes Mais Cr√≠ticos</h3>
                <div id="padroes-criticos">
                    <p style="color: #999; font-size: 14px;">Sem dados</p>
                </div>
            </div>
        </div>
        
        <div class="card" style="margin-bottom: 30px;">
            <h3>üìä Gr√°fico de Presen√ßa por L√≠der</h3>
            <div class="chart-container">
                <canvas id="presencaChart"></canvas>
            </div>
        </div>
        
        <div class="table-container">
            <h3 style="margin-bottom: 20px; color: #1F4E78;">üìã Acompanhamento de L√≠deres</h3>
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('tabela')">Tabela</button>
                <button class="tab-btn" onclick="switchTab('detalhes')">Detalhes</button>
            </div>
            
            <div id="tabela" class="tab-content active">
                <table>
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Email</th>
                            <th>Presen√ßa (%)</th>
                            <th>M√©dia Padr√µes</th>
                            <th>Reuni√µes</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="lideres-table">
                        <tr>
                            <td colspan="7" style="text-align: center; color: #999;">Nenhum l√≠der cadastrado</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div id="detalhes" class="tab-content">
                <div id="detalhes-container">
                    <p style="color: #999; text-align: center;">Selecione um l√≠der para ver detalhes</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Adicionar L√≠der -->
    <div id="addLiderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Adicionar Novo L√≠der</h2>
                <span class="close" onclick="closeModal('addLiderModal')">&times;</span>
            </div>
            <form onsubmit="adicionarLider(event)">
                <div class="form-group">
                    <label>Nome Completo</label>
                    <input type="text" id="liderNome" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="liderEmail" required>
                </div>
                <div class="form-group">
                    <label>Telefone</label>
                    <input type="tel" id="liderTelefone">
                </div>
                <div class="form-group">
                    <label>Data de In√≠cio</label>
                    <input type="date" id="liderDataInicio" required>
                </div>
                <button type="submit" class="btn btn-primary">Salvar L√≠der</button>
            </form>
        </div>
    </div>
    
    <!-- Modal Registrar Reuni√£o -->
    <div id="addReuniaoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Registrar Reuni√£o</h2>
                <span class="close" onclick="closeModal('addReuniaoModal')">&times;</span>
            </div>
            <form onsubmit="adicionarReuniao(event)">
                <div class="form-group">
                    <label>Data</label>
                    <input type="date" id="reuniaoData" required>
                </div>
                <div class="form-group">
                    <label>L√≠der</label>
                    <select id="reuniaoLider" required>
                        <option value="">Selecione um l√≠der...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Presente?</label>
                    <select id="reuniaoPresente" required>
                        <option value="">Selecione...</option>
                        <option value="sim">Sim</option>
                        <option value="nao">N√£o</option>
                        <option value="justificado">Justificado</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Notas</label>
                    <textarea id="reuniaoNotas" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Registrar</button>
            </form>
        </div>
    </div>
    
    <!-- Modal Avaliar Padr√µes -->
    <div id="avaliarModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Avaliar Padr√µes - <span id="avaliarLiderNome"></span></h2>
                <span class="close" onclick="closeModal('avaliarModal')">&times;</span>
            </div>
            <form onsubmit="salvarAvaliacoes(event)">
                <div id="padroes-form"></div>
                <div class="form-group">
                    <label>Observa√ß√µes Gerais</label>
                    <textarea id="observacoes" rows="4"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Salvar Avalia√ß√µes</button>
            </form>
        </div>
    </div>

    <!-- Modal Relat√≥rios -->
    <div id="relatoriosModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Relat√≥rios</h2>
                <span class="close" onclick="closeModal('relatoriosModal')">&times;</span>
            </div>

            <div class="relatorio-tabs">
                <button class="relatorio-tab-btn active" onclick="switchRelatorioTab('geral')">üìä Relat√≥rio Geral</button>
                <button class="relatorio-tab-btn" onclick="switchRelatorioTab('individual')">üë§ Relat√≥rio Individual</button>
            </div>

            <!-- Relat√≥rio Geral -->
            <div id="geral" class="relatorio-content active">
                <h3 style="color: #1F4E78; margin-bottom: 15px;">Comparativo de Padr√µes - Todos os L√≠deres</h3>
                <p style="color: #666; margin-bottom: 15px; font-size: 13px;">Este relat√≥rio √© confidencial e destina-se apenas para sua an√°lise comparativa.</p>
                <div class="chart-container" style="height: 400px;">
                    <canvas id="relatorioGeralChart"></canvas>
                </div>
                <button class="btn btn-success" onclick="exportarRelatorioPDF('geral')" style="margin-top: 15px;">üìÑ Baixar PDF</button>
            </div>

            <!-- Relat√≥rio Individual -->
            <div id="individual" class="relatorio-content">
                <div class="relatorio-select">
                    <label>Selecione um L√≠der:</label>
                    <select id="liderSelect" onchange="carregarRelatorioIndividual()">
                        <option value="">Escolha um l√≠der...</option>
                    </select>
                </div>
                <div id="relatorioIndividualContainer">
                    <p style="color: #999; text-align: center;">Selecione um l√≠der para ver o relat√≥rio</p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Dados simulados
        let lideres = JSON.parse(localStorage.getItem('lideres')) || [];
        let reunioes = JSON.parse(localStorage.getItem('reunioes')) || [];
        let avaliacoes = JSON.parse(localStorage.getItem('avaliacoes')) || {};
        
        const padroes = [
            "Ser salvo por Jesus",
            "Ser batizado nas √°guas",
            "Viver com integridade e santidade",
            "Ser honesto",
            "Fidelidade Conjugal/Pureza",
            "Ser submisso √† lideran√ßa",
            "Ser comprometido e respons√°vel",
            "Estar no programa de L√≠deres",
            "Participar do discipulado",
            "Participar ativamente das reuni√µes",
            "Respeitar seus l√≠deres",
            "Ser pronto a servir",
            "Pr√°tica de ora√ß√£o em l√≠nguas",
            "Medita√ß√£o na Palavra de Deus",
            "Tratar as pessoas com amor e respeito",
            "N√£o falar mal dos outros",
            "Estar disposto a prestar contas"
        ];

        const recomendacoes = [
            {
                titulo: "Ser salvo por Jesus",
                recomendacoes: [
                    "Aprofunde seu relacionamento pessoal com Cristo atrav√©s de ora√ß√£o di√°ria",
                    "Participe de estudos b√≠blicos sobre salva√ß√£o e gra√ßa",
                    "Compartilhe seu testemunho de salva√ß√£o com outros l√≠deres",
                    "Busque orienta√ß√£o pastoral para fortalecer sua f√©"
                ]
            },
            {
                titulo: "Ser batizado nas √°guas",
                recomendacoes: [
                    "Se ainda n√£o foi batizado, converse com o pastor sobre agendamento",
                    "Reflita sobre o significado do batismo em sua vida",
                    "Compartilhe seu testemunho batismal com a comunidade",
                    "Ore pela fidelidade ao compromisso assumido no batismo"
                ]
            },
            {
                titulo: "Viver com integridade e santidade",
                recomendacoes: [
                    "Examine suas a√ß√µes e palavras diariamente √† luz da Palavra de Deus",
                    "Busque viver de forma coerente entre o que pensa, fala e faz",
                    "Evite situa√ß√µes que possam comprometer sua integridade",
                    "Pe√ßa accountability a outros l√≠deres sobre sua vida pessoal"
                ]
            },
            {
                titulo: "Ser honesto",
                recomendacoes: [
                    "Pratique transpar√™ncia em todas as suas comunica√ß√µes",
                    "Admita erros e falhas com humildade",
                    "Evite exageros ou mentiras mesmo que pare√ßam pequenas",
                    "Cultive a confian√ßa atrav√©s da consist√™ncia e veracidade"
                ]
            },
            {
                titulo: "Fidelidade Conjugal/Pureza",
                recomendacoes: [
                    "Fortale√ßa seu relacionamento conjugal atrav√©s de qualidade de tempo",
                    "Estabele√ßa limites saud√°veis em relacionamentos com outras pessoas",
                    "Busque aconselhamento pastoral se necess√°rio",
                    "Pratique a pureza em pensamentos, palavras e a√ß√µes"
                ]
            },
            {
                titulo: "Ser submisso √† lideran√ßa",
                recomendacoes: [
                    "Reconhe√ßa a autoridade espiritual da lideran√ßa da igreja",
                    "Siga as orienta√ß√µes e direcionamentos com disposi√ß√£o",
                    "Expresse suas preocupa√ß√µes de forma respeitosa",
                    "Apoie as decis√µes da lideran√ßa mesmo quando discordar"
                ]
            },
            {
                titulo: "Ser comprometido e respons√°vel",
                recomendacoes: [
                    "Cumpra todos os compromissos assumidos com excel√™ncia",
                    "Seja pontual e confi√°vel em todas as atividades",
                    "Comunique antecipadamente se n√£o puder cumprir algum compromisso",
                    "Busque melhorar continuamente seu desempenho"
                ]
            },
            {
                titulo: "Estar no programa de L√≠deres",
                recomendacoes: [
                    "Participe regularmente das reuni√µes mensais com o pastor",
                    "Complete pelo menos uma aula de forma√ß√£o por semana",
                    "Estude e aplique o conte√∫do aprendido em sua vida",
                    "Compartilhe seus aprendizados com outros l√≠deres"
                ]
            },
            {
                titulo: "Participar do discipulado",
                recomendacoes: [
                    "Envolva-se ativamente no processo de discipulado da igreja",
                    "Participe de todas as reuni√µes de discipulado convocadas",
                    "Busque discipular outros l√≠deres em desenvolvimento",
                    "Aplique os princ√≠pios de discipulado em sua vida pessoal"
                ]
            },
            {
                titulo: "Participar ativamente das reuni√µes",
                recomendacoes: [
                    "Marque presen√ßa em todas as reuni√µes de lideran√ßa",
                    "Comunique antecipadamente se n√£o puder comparecer",
                    "Participe ativamente das discuss√µes e decis√µes",
                    "Chegue no hor√°rio e permane√ßa at√© o final"
                ]
            },
            {
                titulo: "Respeitar seus l√≠deres",
                recomendacoes: [
                    "Reconhe√ßa a autoridade e o chamado de seus l√≠deres",
                    "Evite cr√≠ticas p√∫blicas ou privadas desrespeitosas",
                    "Ore pelos seus l√≠deres regularmente",
                    "Apoie-os em suas decis√µes mesmo diante de imperfei√ß√µes"
                ]
            },
            {
                titulo: "Ser pronto a servir",
                recomendacoes: [
                    "Cultive um cora√ß√£o de servo em todas as situa√ß√µes",
                    "Ofere√ßa-se voluntariamente para ajudar quando necess√°rio",
                    "Coloque as necessidades dos outros acima das suas",
                    "Busque oportunidades para servir com excel√™ncia"
                ]
            },
            {
                titulo: "Pr√°tica de ora√ß√£o em l√≠nguas",
                recomendacoes: [
                    "Dedique pelo menos uma hora di√°ria para ora√ß√£o em l√≠nguas",
                    "Busque orienta√ß√£o sobre o batismo no Esp√≠rito Santo",
                    "Pratique a ora√ß√£o em l√≠nguas em seus momentos de devo√ß√£o",
                    "Participe de momentos de ora√ß√£o corporativa em l√≠nguas"
                ]
            },
            {
                titulo: "Medita√ß√£o na Palavra de Deus",
                recomendacoes: [
                    "Estabele√ßa um tempo di√°rio fixo para ler e meditar na B√≠blia",
                    "Use um plano de leitura b√≠blica estruturado",
                    "Reflita sobre como os ensinamentos se aplicam √† sua vida",
                    "Anote insights e revela√ß√µes que Deus lhe der"
                ]
            },
            {
                titulo: "Tratar as pessoas com amor e respeito",
                recomendacoes: [
                    "Demonstre o amor de Cristo em cada intera√ß√£o",
                    "Ou√ßa com empatia e busque compreender o outro",
                    "Trate todos com dignidade independente de sua posi√ß√£o",
                    "Cultive relacionamentos baseados em respeito m√∫tuo"
                ]
            },
            {
                titulo: "N√£o falar mal dos outros",
                recomendacoes: [
                    "Evite coment√°rios negativos sobre outras pessoas",
                    "Se tiver preocupa√ß√µes, converse diretamente com a pessoa",
                    "Busque sempre ver o melhor nas pessoas",
                    "Corrija com amor e nunca com mal√≠cia"
                ]
            },
            {
                titulo: "Estar disposto a prestar contas",
                recomendacoes: [
                    "Seja transparente sobre sua vida pessoal, familiar e financeira",
                    "Aceite feedback e cr√≠ticas construtivas com humildade",
                    "Preste contas regularmente a seus l√≠deres",
                    "Esteja aberto a mudan√ßas e melhorias sugeridas"
                ]
            }
        ];
        
        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            atualizarDashboard();
            carregarLideres();
            atualizarGraficos();
        });
        
        function atualizarDashboard() {
            document.getElementById('totalLideres').textContent = lideres.length;
            document.getElementById('totalReunioes').textContent = reunioes.length;
            
            if (lideres.length > 0) {
                const presenciaMedia = calcularPresenciaMedia();
                const mediaPardroes = calcularMediaPardroes();
                document.getElementById('presenciaMedia').textContent = presenciaMedia.toFixed(1) + '%';
                document.getElementById('mediaPardroes').textContent = mediaPardroes.toFixed(1);
            }
            
            atualizarAlertas();
        }
        
        function calcularPresenciaMedia() {
            if (lideres.length === 0) return 0;
            let total = 0;
            lideres.forEach(l => {
                const presencas = reunioes.filter(r => r.lider === l.id && r.presente === 'sim').length;
                const totalReunioes = reunioes.filter(r => r.lider === l.id).length;
                total += totalReunioes > 0 ? (presencas / totalReunioes) * 100 : 0;
            });
            return total / lideres.length;
        }
        
        function calcularMediaPardroes() {
            if (Object.keys(avaliacoes).length === 0) return 0;
            let total = 0;
            let count = 0;
            Object.values(avaliacoes).forEach(av => {
                av.forEach(nota => {
                    total += nota;
                    count++;
                });
            });
            return count > 0 ? total / count : 0;
        }
        
        function atualizarAlertas() {
            const container = document.getElementById('alertas-container');
            container.innerHTML = '';
            
            let alertas = [];
            
            lideres.forEach(l => {
                const presencas = reunioes.filter(r => r.lider === l.id && r.presente === 'sim').length;
                const totalReunioes = reunioes.filter(r => r.lider === l.id).length;
                const presenca = totalReunioes > 0 ? (presencas / totalReunioes) * 100 : 100;
                
                if (presenca < 70 && totalReunioes > 0) {
                    alertas.push({
                        tipo: 'warning',
                        msg: `${l.nome}: Presen√ßa baixa (${presenca.toFixed(0)}%)`
                    });
                }
                
                const notas = avaliacoes[l.id] || [];
                const media = notas.length > 0 ? notas.reduce((a, b) => a + b) / notas.length : 0;
                if (media < 3 && notas.length > 0) {
                    alertas.push({
                        tipo: 'danger',
                        msg: `${l.nome}: M√©dia de padr√µes cr√≠tica (${media.toFixed(1)}/5)`
                    });
                }
            });
            
            if (alertas.length === 0) {
                container.innerHTML = '<p style="color: #999; font-size: 14px;">‚úì Nenhum alerta no momento</p>';
            } else {
                alertas.forEach(a => {
                    const div = document.createElement('div');
                    div.className = `alert alert-${a.tipo}`;
                    div.innerHTML = `<span>‚ö†Ô∏è</span> ${a.msg}`;
                    container.appendChild(div);
                });
            }
        }
        
        function openAddLiderModal() {
            document.getElementById('addLiderModal').style.display = 'block';
        }
        
        function openAddReuniao() {
            document.getElementById('addReuniaoModal').style.display = 'block';
            atualizarSelectLideres();
        }

        function abrirRelatorios() {
            document.getElementById('relatoriosModal').style.display = 'block';
            atualizarGraficosRelatorio();
            atualizarSelectLideresRelatorio();
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function adicionarLider(e) {
            e.preventDefault();
            const novoLider = {
                id: Date.now(),
                nome: document.getElementById('liderNome').value,
                email: document.getElementById('liderEmail').value,
                telefone: document.getElementById('liderTelefone').value,
                dataInicio: document.getElementById('liderDataInicio').value
            };
            lideres.push(novoLider);
            localStorage.setItem('lideres', JSON.stringify(lideres));
            closeModal('addLiderModal');
            document.getElementById('addLiderModal').querySelector('form').reset();
            atualizarDashboard();
            carregarLideres();
            atualizarGraficos();
        }
        
        function adicionarReuniao(e) {
            e.preventDefault();
            const novaReuniao = {
                id: Date.now(),
                data: document.getElementById('reuniaoData').value,
                lider: parseInt(document.getElementById('reuniaoLider').value),
                presente: document.getElementById('reuniaoPresente').value,
                notas: document.getElementById('reuniaoNotas').value
            };
            reunioes.push(novaReuniao);
            localStorage.setItem('reunioes', JSON.stringify(reunioes));
            closeModal('addReuniaoModal');
            document.getElementById('addReuniaoModal').querySelector('form').reset();
            atualizarDashboard();
            carregarLideres();
            atualizarGraficos();
        }
        
        function atualizarSelectLideres() {
            const select = document.getElementById('reuniaoLider');
            select.innerHTML = '<option value="">Selecione um l√≠der...</option>';
            lideres.forEach(l => {
                const option = document.createElement('option');
                option.value = l.id;
                option.textContent = l.nome;
                select.appendChild(option);
            });
        }

        function atualizarSelectLideresRelatorio() {
            const select = document.getElementById('liderSelect');
            select.innerHTML = '<option value="">Escolha um l√≠der...</option>';
            lideres.forEach(l => {
                const option = document.createElement('option');
                option.value = l.id;
                option.textContent = l.nome;
                select.appendChild(option);
            });
        }
        
        function carregarLideres() {
            const tbody = document.getElementById('lideres-table');
            if (lideres.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #999;">Nenhum l√≠der cadastrado</td></tr>';
                return;
            }
            
            tbody.innerHTML = '';
            lideres.forEach(l => {
                const presencas = reunioes.filter(r => r.lider === l.id && r.presente === 'sim').length;
                const totalReunioes = reunioes.filter(r => r.lider === l.id).length;
                const presenca = totalReunioes > 0 ? ((presencas / totalReunioes) * 100).toFixed(0) : 'N/A';
                
                const notas = avaliacoes[l.id] || [];
                const media = notas.length > 0 ? (notas.reduce((a, b) => a + b) / notas.length).toFixed(1) : 'N/A';
                
                let status = 'status-good';
                if (presenca !== 'N/A' && presenca < 70) status = 'status-warning';
                if (media !== 'N/A' && media < 3) status = 'status-danger';
                
                const statusText = status === 'status-good' ? '‚úì Bom' : status === 'status-warning' ? '‚ö† Aten√ß√£o' : '‚úó Cr√≠tico';
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${l.nome}</td>
                    <td>${l.email}</td>
                    <td>${presenca}%</td>
                    <td>${media}/5</td>
                    <td>${totalReunioes}</td>
                    <td><span class="status-badge ${status}">${statusText}</span></td>
                    <td>
                        <button class="btn btn-secondary" onclick="abrirAvaliacoes(${l.id}, '${l.nome}')" style="padding: 5px 10px; font-size: 12px;">Avaliar</button>
                        <button class="btn btn-danger" onclick="deletarLider(${l.id})" style="padding: 5px 10px; font-size: 12px;">Deletar</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        function abrirAvaliacoes(liderId, liderNome) {
            document.getElementById('avaliarLiderNome').textContent = liderNome;
            const formDiv = document.getElementById('padroes-form');
            formDiv.innerHTML = '';
            
            padroes.forEach((p, idx) => {
                const notaAtual = (avaliacoes[liderId] && avaliacoes[liderId][idx]) || 0;
                const div = document.createElement('div');
                div.className = 'form-group';
                div.innerHTML = `
                    <label>${p}</label>
                    <div class="rating-input">
                        ${[1, 2, 3, 4, 5].map(i => `
                            <span class="star ${i <= notaAtual ? 'active' : ''}" onclick="selecionarEstrela(this, ${idx}, ${i})">‚òÖ</span>
                        `).join('')}
                    </div>
                `;
                formDiv.appendChild(div);
            });
            
            document.getElementById('avaliarModal').dataset.liderId = liderId;
            document.getElementById('avaliarModal').style.display = 'block';
        }
        
        function selecionarEstrela(el, padraoIdx, nota) {
            const container = el.parentElement;
            container.querySelectorAll('.star').forEach(s => s.classList.remove('active'));
            for (let i = 0; i < nota; i++) {
                container.children[i].classList.add('active');
            }
        }
        
        function salvarAvaliacoes(e) {
            e.preventDefault();
            const liderId = parseInt(document.getElementById('avaliarModal').dataset.liderId);
            const notas = [];
            
            document.querySelectorAll('#padroes-form .rating-input').forEach(container => {
                const activeStars = container.querySelectorAll('.star.active').length;
                notas.push(activeStars);
            });
            
            avaliacoes[liderId] = notas;
            localStorage.setItem('avaliacoes', JSON.stringify(avaliacoes));
            closeModal('avaliarModal');
            atualizarDashboard();
            carregarLideres();
            atualizarGraficos();
        }
        
        function deletarLider(liderId) {
            if (confirm('Tem certeza que deseja deletar este l√≠der?')) {
                lideres = lideres.filter(l => l.id !== liderId);
                localStorage.setItem('lideres', JSON.stringify(lideres));
                atualizarDashboard();
                carregarLideres();
                atualizarGraficos();
            }
        }
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function switchRelatorioTab(tabName) {
            document.querySelectorAll('.relatorio-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.relatorio-tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'geral') {
                setTimeout(() => atualizarGraficosRelatorio(), 100);
            }
        }
        
        let presencaChart, relatorioGeralChart;
        
        function atualizarGraficos() {
            const nomes = lideres.map(l => l.nome);
            const presencas = lideres.map(l => {
                const presencas = reunioes.filter(r => r.lider === l.id && r.presente === 'sim').length;
                const total = reunioes.filter(r => r.lider === l.id).length;
                return total > 0 ? ((presencas / total) * 100).toFixed(0) : 0;
            });
            
            // Gr√°fico de Presen√ßa
            const ctxPresenca = document.getElementById('presencaChart').getContext('2d');
            if (presencaChart) presencaChart.destroy();
            presencaChart = new Chart(ctxPresenca, {
                type: 'bar',
                data: {
                    labels: nomes,
                    datasets: [{
                        label: 'Presen√ßa (%)',
                        data: presencas,
                        backgroundColor: '#4472C4',
                        borderColor: '#1F4E78',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        function atualizarGraficosRelatorio() {
            const nomes = lideres.map(l => l.nome);
            
            const ctxGeral = document.getElementById('relatorioGeralChart');
            if (!ctxGeral) return;
            
            const ctx = ctxGeral.getContext('2d');
            if (relatorioGeralChart) relatorioGeralChart.destroy();
            
            relatorioGeralChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: padroes,
                    datasets: lideres.map((l, idx) => ({
                        label: l.nome,
                        data: avaliacoes[l.id] || Array(padroes.length).fill(0),
                        borderColor: `hsl(${idx * 360 / (lideres.length || 1)}, 70%, 50%)`,
                        backgroundColor: `hsla(${idx * 360 / (lideres.length || 1)}, 70%, 50%, 0.1)`
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 5
                        }
                    }
                }
            });
        }

        function carregarRelatorioIndividual() {
            const liderId = parseInt(document.getElementById('liderSelect').value);
            if (!liderId) {
                document.getElementById('relatorioIndividualContainer').innerHTML = '<p style="color: #999; text-align: center;">Selecione um l√≠der para ver o relat√≥rio</p>';
                return;
            }

            const lider = lideres.find(l => l.id === liderId);
            const notas = avaliacoes[liderId] || [];

            if (notas.length === 0) {
                document.getElementById('relatorioIndividualContainer').innerHTML = '<p style="color: #999; text-align: center;">Nenhuma avalia√ß√£o registrada para este l√≠der</p>';
                return;
            }

            let html = `
                <div style="margin-bottom: 20px; padding: 20px; background: #f9f9f9; border-radius: 8px; border-left: 4px solid #4472C4;">
                    <h3 style="color: #1F4E78; margin-bottom: 10px;">Relat√≥rio Individual de Avalia√ß√£o</h3>
                    <p><strong>L√≠der:</strong> ${lider.nome}</p>
                    <p><strong>Email:</strong> ${lider.email}</p>
                    <p><strong>Telefone:</strong> ${lider.telefone}</p>
                    <p><strong>Data de In√≠cio:</strong> ${lider.dataInicio}</p>
                    <p><strong>Data do Relat√≥rio:</strong> ${new Date().toLocaleDateString('pt-BR')}</p>
                </div>
            `;

            padroes.forEach((p, idx) => {
                const nota = notas[idx] || 0;
                const percentual = (nota / 5) * 100;
                const cor = nota >= 4 ? '#70AD47' : nota >= 3 ? '#FFC107' : '#C5504C';
                const recomendacao = recomendacoes[idx];
                
                html += `
                    <div class="padrao-item">
                        <div class="padrao-titulo">${idx + 1}. ${p}</div>
                        <div class="padrao-nota">
                            <div class="nota-barra">
                                <div class="nota-preenchida" style="width: ${percentual}%; background: ${cor};">
                                    ${nota}/5
                                </div>
                            </div>
                        </div>
                        <div class="recomendacoes">
                            <h5>üìã Recomenda√ß√µes para alcan√ßar nota 5:</h5>
                            <ul>
                                ${recomendacao.recomendacoes.map(r => `<li>${r}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
            });

            const mediaGeral = (notas.reduce((a, b) => a + b) / notas.length).toFixed(1);
            const presencas = reunioes.filter(r => r.lider === liderId && r.presente === 'sim').length;
            const totalReunioes = reunioes.filter(r => r.lider === liderId).length;
            const presenca = totalReunioes > 0 ? ((presencas / totalReunioes) * 100).toFixed(0) : 'N/A';

            html += `
                <div class="resumo-geral">
                    <h3>Resumo da Avalia√ß√£o</h3>
                    <div class="resumo-item">
                        <span><strong>M√©dia Geral de Padr√µes:</strong></span>
                        <span style="font-weight: bold; color: ${mediaGeral >= 4 ? '#70AD47' : mediaGeral >= 3 ? '#FFC107' : '#C5504C'};">${mediaGeral}/5</span>
                    </div>
                    <div class="resumo-item">
                        <span><strong>Presen√ßa em Reuni√µes:</strong></span>
                        <span style="font-weight: bold;">${presenca}%</span>
                    </div>
                    <div class="resumo-item">
                        <span><strong>Total de Reuni√µes:</strong></span>
                        <span style="font-weight: bold;">${totalReunioes}</span>
                    </div>
                    <div class="resumo-item" style="margin-top: 15px; padding-top: 15px; border-top: 2px solid #4472C4;">
                        <span><strong>Pr√≥ximas Etapas:</strong></span>
                        <span style="text-align: right;">Revisar recomenda√ß√µes e agendar acompanhamento</span>
                    </div>
                </div>

                <button class="btn btn-success" onclick="exportarRelatorioPDF('individual')" style="margin-top: 20px;">üìÑ Baixar PDF para Imprimir</button>
            `;

            document.getElementById('relatorioIndividualContainer').innerHTML = html;
        }
        
        function exportarRelatorioPDF(tipo) {
            let elemento;
            let nomeArquivo;

            if (tipo === 'geral') {
                elemento = document.querySelector('#geral');
                nomeArquivo = 'relatorio_geral_lideres.pdf';
            } else {
                elemento = document.querySelector('#relatorioIndividualContainer');
                nomeArquivo = `relatorio_individual_${document.getElementById('liderSelect').options[document.getElementById('liderSelect').selectedIndex].text}.pdf`;
            }

            const opt = {
                margin: 10,
                filename: nomeArquivo,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' }
            };
            html2pdf().set(opt).from(elemento).save();
        }
        
        function exportarCSV() {
            let csv = 'Nome,Email,Telefone,Data In√≠cio,Presen√ßa (%),M√©dia Padr√µes,Total Reuni√µes\n';
            lideres.forEach(l => {
                const presencas = reunioes.filter(r => r.lider === l.id && r.presente === 'sim').length;
                const totalReunioes = reunioes.filter(r => r.lider === l.id).length;
                const presenca = totalReunioes > 0 ? ((presencas / totalReunioes) * 100).toFixed(0) : 'N/A';
                const notas = avaliacoes[l.id] || [];
                const media = notas.length > 0 ? (notas.reduce((a, b) => a + b) / notas.length).toFixed(1) : 'N/A';
                csv += `${l.nome},${l.email},${l.telefone},${l.dataInicio},${presenca},${media},${totalReunioes}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'lideres.csv';
            a.click();
        }
        
        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }
    </script>
</body>
</html>
